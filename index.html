<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Para mi amor ðŸ’–</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      background: black;
      color: white;
      overflow: hidden;
    }

    .pantalla {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .center { text-align: center; }

    h1, h2 { color: white; }

    button {
      margin: 20px;
      padding: 15px 30px;
      font-size: 1.2rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #ff69b4;
      color: white;
      transition: 0.3s;
    }

    button:hover { background-color: #ff1493; }

    /* Laberinto */
    #laberinto {
      background: #111;
      position: relative;
      display: none;
    }

    #inicio, #meta {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    #inicio {
      background: lime;
      top: 20px; left: 20px;
    }

    #meta {
      background: red;
      bottom: 20px; right: 20px;
    }

    .pared {
      position: absolute;
      background: #444;
    }

    .p1 { top: 100px; left: 50px; width: 80%; height: 20px; }
    .p2 { top: 200px; left: 0; width: 70%; height: 20px; }
    .p3 { top: 300px; right: 0; width: 60%; height: 20px; }

    /* Final */
    #mensaje-final {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
      display: none;
    }

    audio { display: none; }
  </style>
</head>
<body>
  <!-- MÃšSICA DE FONDO -->
  <audio id="musica" loop>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_7e12b09709.mp3" type="audio/mpeg">
  </audio>

  <!-- EFECTOS -->
  <audio id="tecleo" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2a3b3ef57b.mp3?filename=typewriter-sound-112360.mp3"></audio>
  <audio id="ding" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3b4ef445ac.mp3?filename=correct-answer-3-111447.mp3"></audio>
  <audio id="firework" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_1bbac0e1a3.mp3?filename=fireworks-17028.mp3"></audio>

  <!-- Fase 1: Mensaje inicial -->
  <div id="intro" class="pantalla center">
    <h1 id="mensaje"></h1>
  </div>

  <!-- Fase 2: Pacman -->
  <canvas id="pacman" class="pantalla"></canvas>

  <!-- Fase 3: Laberinto -->
  <div id="laberinto" class="pantalla">
    <div id="inicio"></div>
    <div id="meta"></div>
    <div class="pared p1"></div>
    <div class="pared p2"></div>
    <div class="pared p3"></div>
  </div>

  <!-- Fase 4: Pregunta -->
  <div id="pregunta" class="pantalla center">
    <h2 id="texto-pregunta">Â¿Me amas? ðŸ’˜</h2>
    <button id="si">SI ðŸ’ž</button>
    <button id="no">NO ðŸ’”</button>
  </div>

  <!-- Fase 5: Final -->
  <canvas id="final" class="pantalla"></canvas>
  <div id="mensaje-final" class="center">
    <h1>ðŸ’« Te amo Tatiana ðŸ’«</h1>
    <p>Gracias por estos hermosos 4 meses de risas y amor ðŸ’•</p>
  </div>

  <script>
    // --- AUDIO ---
    const musica = document.getElementById("musica");
    const tecleo = document.getElementById("tecleo");
    const ding = document.getElementById("ding");
    const fireworkSound = document.getElementById("firework");

    // --- FASE 1: MENSAJE INICIAL ---
    const mensaje = "Hola amor ðŸ’–, desde hace un tiempo estÃ¡s esperando esto... asÃ­ que... disfrÃºtalo ðŸ’•";
    let i = 0;

    const intro = document.getElementById("intro");
    const canvasPacman = document.getElementById("pacman");
    const laberinto = document.getElementById("laberinto");
    const pregunta = document.getElementById("pregunta");
    const finalCanvas = document.getElementById("final");
    const mensajeFinal = document.getElementById("mensaje-final");

    intro.style.display = "flex";

    function escribir() {
      if (i < mensaje.length) {
        document.getElementById("mensaje").innerHTML += mensaje.charAt(i);
        tecleo.currentTime = 0;
        tecleo.play();
        i++;
        setTimeout(escribir, 80);
      } else {
        ding.play();
        musica.volume = 0.4;
        musica.play();
        setTimeout(() => {
          intro.style.display = "none";
          iniciarPacman();
        }, 1200);
      }
    }
    escribir();

    // --- FASE 2: PACMAN ---
    function iniciarPacman() {
      canvasPacman.style.display = "block";
      const ctx = canvasPacman.getContext("2d");
      canvasPacman.width = window.innerWidth;
      canvasPacman.height = window.innerHeight;
      
      let x = 50, y = canvasPacman.height / 2, size = 50;
      let mouth = 0.2, direction = 1;
      
      const interval = setInterval(() => {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvasPacman.width, canvasPacman.height);
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.arc(x, y, size, mouth * Math.PI, (2 - mouth) * Math.PI);
        ctx.fillStyle = "yellow";
        ctx.fill();

        mouth += direction * 0.02;
        if (mouth <= 0.1 || mouth >= 0.3) direction *= -1;

        x += 10;
        if (x - size > canvasPacman.width) {
          clearInterval(interval);
          ding.play();
          canvasPacman.style.display = "none";
          iniciarLaberinto();
        }
      }, 30);
    }

    // --- FASE 3: LABERINTO ---
    function iniciarLaberinto() {
      laberinto.style.display = "block";
      const inicio = document.getElementById("inicio");
      const meta = document.getElementById("meta");
      const paredes = document.querySelectorAll(".pared");

      function checkCollision(circle, rect) {
        const cRect = circle.getBoundingClientRect();
        const rRect = rect.getBoundingClientRect();
        return !(
          cRect.right < rRect.left ||
          cRect.left > rRect.right ||
          cRect.bottom < rRect.top ||
          cRect.top > rRect.bottom
        );
      }

      laberinto.addEventListener("touchmove", (e) => {
        const touch = e.touches[0];
        inicio.style.left = `${touch.clientX - 20}px`;
        inicio.style.top = `${touch.clientY - 20}px`;

        for (let p of paredes) {
          if (checkCollision(inicio, p)) {
            alert("Â¡Oh no! Tocaste una pared ðŸ˜…. Intenta otra vez.");
            iniciarLaberinto();
            return;
          }
        }

        if (checkCollision(inicio, meta)) {
          laberinto.style.display = "none";
          ding.play();
          iniciarPregunta();
        }
      }, { passive: false });
    }

    // --- FASE 4: PREGUNTA ---
    function iniciarPregunta() {
      pregunta.style.display = "flex";
      const no = document.getElementById("no");
      const si = document.getElementById("si");
      const texto = document.getElementById("texto-pregunta");

      no.addEventListener("mouseover", () => {
        texto.innerText = ">:V";
        no.style.position = "absolute";
        no.style.left = `${Math.random() * (window.innerWidth - 100)}px`;
        no.style.top = `${Math.random() * (window.innerHeight - 50)}px`;
      });

      si.addEventListener("click", () => {
        pregunta.style.display = "none";
        ding.play();
        iniciarFinal();
      });
    }

    // --- FASE 5: FINAL ---
    function iniciarFinal() {
      finalCanvas.style.display = "block";
      mensajeFinal.style.display = "block";
      const ctx = finalCanvas.getContext("2d");
      finalCanvas.width = window.innerWidth;
      finalCanvas.height = window.innerHeight;

      const estrellas = [];
      for (let i = 0; i < 100; i++) {
        estrellas.push({
          x: Math.random() * finalCanvas.width,
          y: Math.random() * finalCanvas.height,
          r: Math.random() * 2,
        });
      }

      function dibujarFuegos() {
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);

        ctx.fillStyle = "white";
        for (let e of estrellas) {
          ctx.beginPath();
          ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
          ctx.fill();
        }

        if (Math.random() < 0.05) {
          const x = Math.random() * finalCanvas.width;
          const y = Math.random() * finalCanvas.height / 2;
          const color = `hsl(${Math.random() * 360},100%,60%)`;
          for (let i = 0; i < 30; i++) {
            ctx.beginPath();
            ctx.arc(
              x + Math.cos(i * 12) * 20,
              y + Math.sin(i * 12) * 20,
              3,
              0,
              Math.PI * 2
            );
            ctx.fillStyle = color;
            ctx.fill();
          }
          fireworkSound.currentTime = 0;
          fireworkSound.play();
        }

        requestAnimationFrame(dibujarFuegos);
      }

      dibujarFuegos();
    }
  </script>
</body>
</html>
